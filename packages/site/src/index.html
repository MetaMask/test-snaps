<!doctype html>
<html>
  </head>
    <title>Test Snaps</title>
    <link rel="icon" type="image/svg" href="./icon.svg"/>
    <link href="style.css" rel="stylesheet" type="text/css" media="all" />
  </head>
  <body>
    <code class="fox">
    MMm*mmMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMmm*mMM
    MM*./***mMMMMMMMMMMMMMMMMMMMMMMMMMMm***/.*MM
    MM/...///*mMMMMMMMMMMMMMMMMMMMMMMm*///.../MM
    Mm.....//../*mMMMMMMMMMMMMMMMMm*/..//.....mM
    M*....../*....*mMMMMMMMMMMMMm*....*/......*M
    M/........*.....*//////////*...../......../M
    m..........*/...//........//.../*..........m
    M/..........//.../......../...//........../M
    M/.........../*/./.......//./*/.........../M
    M*.............////......////.............*M
    Mm...............**......**...............mM
    Mm/...............*/..../*.............../mM
    MM/............../*/..../*/............../MM
    Mm..............//./...././/..............mM
    MM*............*/../..../../*............*MM
    MM/........../*..../..../....*/........../MM
    MMm.........//...../..../.....//.........mMM
    MMm......//**....../..../......**//......mMM
    MMM/..////.*......./..../......././///../MMM
    MMMm*//..../......./..../......./....//*mMMM
    MMMm......*////////*....*////////*......mMMM
    MMM*......*////////*....*////////*......*MMM
    MMM/....../*......./..../.......*/....../MMM
    MMm........**/./m*./..../.**/..**........mMM
    MM*........//*mMMM///..///mMMm*//........*MM
    MM/........././*mM*//..//*Mm*/./........./MM
    Mm..........//.../**/../**/...//..........mM
    M*...........*..../*/../*/..../...........*M
    M*///////////*/.../m/../m/.../*///////////*M
    M*.........../*/...m/../m.../*/...........*M
    Mm.........../..//.*....*./*../...........mM
    MM/........../...//******//.../........../MM
    MM*........../....*MMMMMM*..../..........*MM
    MMm........../....*MMMMMM*..../..........mMM
    MMm/........//....*MMMMMM*....//......../mMM
    MMM/....../*mm*...*mmmmmm*...*mm*/....../MMM
    MMM*../*mmMMMMMm///......//*mMMMMMmm*/..*MMM
    MMMm*mMMMMMMMMMMm**......**mMMMMMMMMMMm*mMMM
    MMMMMMMMMMMMMMMMMm/....../mMMMMMMMMMMMMMMMMM
    MMMMMMMMMMMMMMMMMMmmmmmmmmMMMMMMMMMMMMMMMMMM
    </code>
    <h1>Test Snaps</h1>
    <section>
      <h1>Confirm Snap</h1>
      <label>SnapId</label>
      <input class="snapId1">
      <br/>
      <button class="connectHello">Connect To Confirm Snap</button>
      <input class="confirmPromptInput" placeholder="hello"/>
      <input class="confirmDescription"/>
      <input class="confirmTextAreaContent"/>
      <button class="sendConfirmButton">Send Inputs to Hello Snap</button>
      <span class="confirmResult"></span>
    </section>

    <section>
      <h1>Error Snap</h1>
      <label>SnapId</label>
      <input class="snapId2">
      <br/>
      <button class="connectError">Connect Error Snap</button>
      <button class="sendError">Send Test to Error Snap</button>
      <span class="errorResult"></span>
    </section>

    <section>
      <h1>BIP-44 Snap</h1>
      <label>SnapId</label>
      <input class="snapId3">
      <br/>
      <button class="connectBip44">Connect BIP-44 Snap</button>
      <button class="sendBip44">Send Test to BIP-44 Snap</button>
      <br/>
      <span class="bip44Result"></span>
      <br/>
      <input class="bip44SignMessage" placeholder="message"/>
      <button class="sendBip44MessageButton">Sign Message with BIP-44 Snap</button>
      <span class="bip44SignMessageResult"></span>
    </section>

  </body>

  <script>
    /**
     * Confirm Snap
     */
    const snapId1 = document.querySelector('.snapId1');
    snapId1.value = 'local:http://localhost:8081';

    const connectConfirmButton = document.querySelector('button.connectHello')
    const sendConfirmButton = document.querySelector('button.sendConfirmButton')
    const promptInput = document.querySelector('.confirmPromptInput');
    const description = document.querySelector('.confirmDescription');
    const textAreaContent = document.querySelector('.confirmTextAreaContent');
    const confirmResult = document.querySelector('.confirmResult');

    connectConfirmButton.addEventListener('click', connectConfirm)
    sendConfirmButton.addEventListener('click', sendConfirm)
    promptInput.value = 'hello';

    // here we get permissions to interact with and install the snap
    async function connectConfirm () {
      await ethereum.request({
        method: 'wallet_enable',
        params: [{
          wallet_snap: { [snapId1.value]: {} },
        }]
      })
    }

    // here we call the snap's "confirm" method
    async function sendConfirm () {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId1.value, {
            method: 'confirm',
            params: [promptInput.value, description.value, textAreaContent.value]
          }]
        })
        confirmResult.innerHTML = result;
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }

    /**
     * Error snap
     */
    const snapId2 = document.querySelector('.snapId2');
    snapId2.value = 'local:http://localhost:8082';
    const connectErrorButton = document.querySelector('button.connectError')
    const sendErrorButton = document.querySelector('button.sendError')
    const errorResult = document.querySelector('span.errorResult')

    connectErrorButton.addEventListener('click', connectError)
    sendErrorButton.addEventListener('click', sendError)

    // actions
    async function connectError () {
      await ethereum.request({
        method: 'wallet_enable',
        params: [{
          wallet_snap: { [snapId2.value]: {} },
        }]
      })
    }

    // here we call the error snap with any method
    async function sendError () {
      try {
        await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId2.value, {
            method: 'test'
          }]
        })
        errorResult.innerHTML = 'Erroring request sent'
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }

    /**
     * BIP-44 snap
     */
    const snapId3 = document.querySelector('.snapId3');
    snapId3.value = 'local:http://localhost:8083';
    const connectBip44Button = document.querySelector('button.connectBip44')
    const sendBip44Button = document.querySelector('button.sendBip44')
    const bip44Result = document.querySelector('span.bip44Result')

    const bip44SignMessage = document.querySelector('.bip44SignMessage')
    const sendBip44MessageButton = document.querySelector('button.sendBip44MessageButton')
    const bip44SignMessageResult = document.querySelector('.bip44SignMessageResult')

    connectBip44Button.addEventListener('click', connectBip44)
    sendBip44Button.addEventListener('click', sendBip44)
    sendBip44MessageButton.addEventListener('click', sendBip44Message)

    async function connectBip44 () {
      await ethereum.request({
        method: 'wallet_enable',
        params: [{
          wallet_snap: { [snapId3.value]: {} },
        }]
      })
    }

    async function sendBip44 () {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId3.value, {
            method: 'getAccount',
          }]
        })
        bip44Result.innerHTML = `Public key: ${JSON.stringify(result)}`;
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }

    async function sendBip44Message () {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId3.value, {
            method: 'signMessage',
            params: [bip44SignMessage.value]
          }]
        })
        bip44SignMessageResult.innerHTML = `message: ${JSON.stringify(result)}`;
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }
  </script>
</html>
