<!DOCTYPE html>
<html>
  <head>
    <title>Test Snaps</title>
    <link rel="icon" type="image/svg" href="./icon.svg" />
    <link href="style.css" rel="stylesheet" type="text/css" media="all" />

    <!-- Euclid Circular B fonts -->
    <link
      rel="preload"
      href="EuclidCircularB-Bold.woff"
      as="font"
      type="font/woff"
      crossorigin=""
    />
    <link
      rel="preload"
      href="EuclidCircularB-Regular.woff"
      as="font"
      type="font/woff"
      crossorigin=""
    />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <main class="container-fluid">
      <!-- Header -->
      <div class="container">
        <div class="row justify-content-center">
          <div class="col">
            <h1 class="testSnapsLogo">Test Snaps</h1>
            <img src="snaps-ascii-to-logo.gif" width="200" alt="" />
          </div>
        </div>
      </div>
      <br />
      
      <!-- Confirm Snap Interface -->
      <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
        <div class="card testSnapsReg">         
            <div class="card-header">
               <h1 class="testSnapsName">Confirm Snap</h1>
            </div>
            <div class="card-body">
              <label>SnapId</label>
              <input class="snapId1" />
              <br />
              <br />
              <button class="connectHello btn btn-primary btn-med btn-block mb-3 btn-wide">
                Connect To Confirm Snap
              </button>
              <br />
              <input class="confirmPromptInput" placeholder="hello" />
              <br />
              <br />
              <input class="confirmDescription" placeholder="description" />
              <br />
              <br />
              <input class="confirmTextAreaContent" placeholder="content area" />
              <br />
              <br />
              <button class="sendConfirmButton btn btn-primary btn-med btn-block mb-3 btn-wide">
                Send Inputs to Hello Snap
              </button>
              <p class="info-text alert alert-secondary">
                <span class="confirmResult"></span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <br />

      <!-- Error Snap Interface -->
      <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
        <div class="card testSnapsReg">         
            <div class="card-header">
               <h1 class="testSnapsName">Error Snap</h1>
            </div>
            <div class="card-body">
              <label>SnapId</label>
              <input class="snapId2" />
              <br />
              <br />
              <button class="connectError btn btn-primary btn-med btn-block mb-3 btn-wide">
                Connect Error Snap
              </button>
              <button class="sendError btn btn-primary btn-med btn-block mb-3 btn-wide">
                Send Test to Error Snap
              </button>
              <p class="info-text alert alert-secondary">
                <span class="errorResult"></span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <br />

      <!-- BIP-44 Snap Interface -->
      <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
        <div class="card testSnapsReg">         
            <div class="card-header">
               <h1 class="testSnapsName">BIP-44 Snap</h1>
            </div>
            <div class="card-body">
              <label>SnapId</label>
              <input class="snapId3" />
              <br />
              <br />
              <button class="connectBip44 btn btn-primary btn-med btn-block mb-3 btn-wide">
                Connect BIP-44 Snap
              </button>
              <button class="sendBip44 btn btn-primary btn-med btn-block mb-3 btn-wide">
                Send Test to BIP-44 Snap
              </button>
              <p class="info-text alert alert-secondary">
                <span class="bip44Result"></span>
              </p>
              <br />
              <input class="bip44SignMessage" placeholder="message" />
              <br />
              <br />
              <button class="sendBip44MessageButton btn btn-primary btn-med btn-block mb-3 btn-wide">
                Sign Message with BIP-44 Snap
              </button>
              <br />
              <p class="info-text alert alert-secondary">
                <span class="bip44SignMessageResult"></span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <br />      

      <!-- manageState Snap Interface -->
        <div class="col-xl-4 col-lg-6 col-md-12 col-sm-12 col-12">
          <div class="card testSnapsReg">
            <div class="card-header">
              <h1 class="testSnapsName">manageState Snap</h1>
            </div>
            <div class="card-body">
              <label>SnapId</label>
              <input class="snapId4" />
              <br />
              <br />
              <button class="connectManageState btn btn-primary btn-med btn-block mb-3 btn-wide">Connect manageState Snap</button>
              <br />
              <input class="dataManageState" placeholder="data" />
              <br />
              <br />
              <button class="sendManageState btn btn-primary btn-med btn-block mb-3 btn-wide">Send data to manageState Snap</button>
              <br />
              <p class="info-text alert alert-secondary">
              <span class="sendManageStateResult"></span>
              </p>
              <button class="retrieveManageState btn btn-primary btn-med btn-block mb-3 btn-wide">
                Get data from manageState Snap
              </button>
              <br />
              <p class="info-text alert alert-secondary">
                <span class="retrieveManageStateResult"></span> 
              </p>
              <button class="clearManageState btn btn-primary btn-med btn-block mb-3 btn-wide">Clear data of manageState Snap</button>
              <p class="info-text alert alert-secondary">
                <span class="clearManageStateResult"></span>
              </p>
            </div>
          </div>
        </div>
        <br />        
    </main>
  </body>


  <!-- All interface connection logic below -->
  <script>
    const version = document.location.href.includes(
      'https://metamask.github.io/test-snaps',
    )
      ? document.location.pathname.split('/')[2]
      : undefined;

    /**
     * Confirm Snap
     */
    const snapId1 = document.querySelector('.snapId1');
    snapId1.value = 'local:http://localhost:8081';

    const connectConfirmButton = document.querySelector('button.connectHello');
    const sendConfirmButton = document.querySelector(
      'button.sendConfirmButton',
    );
    const promptInput = document.querySelector('.confirmPromptInput');
    const description = document.querySelector('.confirmDescription');
    const textAreaContent = document.querySelector('.confirmTextAreaContent');
    const confirmResult = document.querySelector('.confirmResult');

    connectConfirmButton.addEventListener('click', connectConfirm);
    sendConfirmButton.addEventListener('click', sendConfirm);
    promptInput.value = 'hello';

    // here we get permissions to interact with and install the snap
    async function connectConfirm() {
      await ethereum.request({
        method: 'wallet_enable',
        params: [
          {
            wallet_snap: { [snapId1.value]: { version } },
          },
        ],
      });
    }

    // here we call the snap's "confirm" method
    async function sendConfirm() {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId1.value,
            {
              method: 'confirm',
              params: [
                promptInput.value,
                description.value,
                textAreaContent.value,
              ],
            },
          ],
        });
        confirmResult.innerHTML = result;
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    /**
     * Error snap
     */
    const snapId2 = document.querySelector('.snapId2');
    snapId2.value = 'local:http://localhost:8082';
    const connectErrorButton = document.querySelector('button.connectError');
    const sendErrorButton = document.querySelector('button.sendError');
    const errorResult = document.querySelector('span.errorResult');

    connectErrorButton.addEventListener('click', connectError);
    sendErrorButton.addEventListener('click', sendError);

    // actions
    async function connectError() {
      await ethereum.request({
        method: 'wallet_enable',
        params: [
          {
            wallet_snap: { [snapId2.value]: { version } },
          },
        ],
      });
    }

    // here we call the error snap with any method
    async function sendError() {
      try {
        await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId2.value,
            {
              method: 'test',
            },
          ],
        });
        errorResult.innerHTML = 'Erroring request sent';
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    /**
     * BIP-44 snap
     */
    const snapId3 = document.querySelector('.snapId3');
    snapId3.value = 'local:http://localhost:8083';
    const connectBip44Button = document.querySelector('button.connectBip44');
    const sendBip44Button = document.querySelector('button.sendBip44');
    const bip44Result = document.querySelector('span.bip44Result');

    const bip44SignMessage = document.querySelector('.bip44SignMessage');
    const sendBip44MessageButton = document.querySelector(
      'button.sendBip44MessageButton',
    );
    const bip44SignMessageResult = document.querySelector(
      '.bip44SignMessageResult',
    );

    connectBip44Button.addEventListener('click', connectBip44);
    sendBip44Button.addEventListener('click', sendBip44);
    sendBip44MessageButton.addEventListener('click', sendBip44Message);

    async function connectBip44() {
      await ethereum.request({
        method: 'wallet_enable',
        params: [
          {
            wallet_snap: { [snapId3.value]: { version } },
          },
        ],
      });
    }

    async function sendBip44() {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId3.value,
            {
              method: 'getAccount',
            },
          ],
        });
        bip44Result.innerHTML = `Public key: ${JSON.stringify(result)}`;
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function sendBip44Message() {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId3.value,
            {
              method: 'signMessage',
              params: [bip44SignMessage.value],
            },
          ],
        });
        bip44SignMessageResult.innerHTML = `message: ${JSON.stringify(result)}`;
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    /**
     * manageState snap
     */
    const snapId4 = document.querySelector('.snapId4');
    snapId4.value = 'local:http://localhost:8084';
    const connectManageStateButton = document.querySelector(
      'button.connectManageState',
    );
    const sendManageStateButton = document.querySelector(
      'button.sendManageState',
    );
    const retrieveManageStateButton = document.querySelector(
      'button.retrieveManageState',
    );
    const clearManageStateButton = document.querySelector(
      'button.clearManageState',
    );
    const dataManageStateInput = document.querySelector('.dataManageState');
    const sendManageStateResult = document.querySelector(
      '.sendManageStateResult',
    );
    const retrieveManageStateResult = document.querySelector(
      '.retrieveManageStateResult',
    );
    const clearManageStateResult = document.querySelector(
      '.clearManageStateResult',
    );

    connectManageStateButton.addEventListener('click', connectManageState);
    sendManageStateButton.addEventListener('click', sendManageState);
    retrieveManageStateButton.addEventListener('click', retrieveManageState);
    clearManageStateButton.addEventListener('click', clearManageState);

    async function connectManageState() {
      await ethereum.request({
        method: 'wallet_enable',
        params: [
          {
            wallet_snap: { [snapId4.value]: { version } },
          },
        ],
      });
    }

    async function sendManageState() {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId4.value,
            {
              method: 'storeTestData',
              params: [dataManageStateInput.value],
            },
          ],
        });
        sendManageStateResult.innerHTML = 'true';
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function retrieveManageState() {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId4.value,
            {
              method: 'retrieveTestData',
            },
          ],
        });
        retrieveManageStateResult.innerHTML = `${JSON.stringify(result)}`;
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    async function clearManageState() {
      try {
        const result = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId4.value,
            {
              method: 'clearTestData',
            },
          ],
        });
        clearManageStateResult.innerHTML = 'true';
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }

    /**
     * Notification Snap
     */
    const snapId5 = document.querySelector('.snapId5');
    snapId5.value = 'local:http://localhost:8085';

    const connectNotificationButton = document.querySelector(
      'button.connectNotification',
    );
    const sendInAppNotificationButton = document.querySelector(
      'button.sendInAppNotification',
    );
    const sendNativeNotificationButton = document.querySelector(
      'button.sendNativeNotification',
    );

    connectNotificationButton.addEventListener('click', connectNotification);
    sendInAppNotificationButton.addEventListener('click', () =>
      sendNotification('inApp'),
    );
    sendNativeNotificationButton.addEventListener('click', () =>
      sendNotification('native'),
    );

    async function connectNotification() {
      await ethereum.request({
        method: 'wallet_enable',
        params: [
          {
            wallet_snap: { [snapId5.value]: { version } },
          },
        ],
      });
    }

    async function sendNotification(method) {
      try {
        await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [
            snapId5.value,
            {
              method: method,
            },
          ],
        });
      } catch (err) {
        console.error(err);
        alert('Problem happened: ' + err.message || err);
      }
    }
  </script>
</html>
