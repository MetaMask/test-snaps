<!doctype html>
<html>
  </head>
    <title>Test Snaps</title>
  </head>
  <body>
    <h1>Test Snaps</h1>
    <section>
      <h1>Confirm Snap</h1>
      <label>SnapId</label>
      <input class="snapId">
      <br/>
      <button class="connectHello">Connect To Confirm Snap</button>
      <input class="confirmPromptInput" placeholder="hello"/>
      <input class="confirmDescription"/>
      <input class="confirmTextAreaContent"/>
      <button class="sendHello">Send Inputs to Hello Snap</button>
      <span class="sendResults"></span>
    </section>
    <section>
      <h1>Error Snap</h1>
      <label>SnapId</label>
      <input class="snapId2">
      <button class="connectError">Connect Error Snap</button>
      <button class="sendError">Send Test to Error Snap</button>
    </section>
  </body>

  <script>
    // confirm snap
    const snapId = document.querySelector('.snapId');
    snapId.value = 'local:http://localhost:8082';

    const connectButton = document.querySelector('button.connectHello')
    const sendButton = document.querySelector('button.sendHello')
    const promptInput = document.querySelector('.confirmPromptInput');
    const description = document.querySelector('.confirmDescription');
    const textAreaContent = document.querySelector('.confirmTextAreaContent');
    const sendResults = document.querySelector('.sendResults');

    promptInput.value = 'hello';

    // error snap
    const snapId2 = document.querySelector('.snapId2');
    snapId2.value = 'local:http://localhost:8081';
    const connectErrorButton = document.querySelector('button.connectError')
    const sendErrorButton = document.querySelector('button.sendError')

    connectButton.addEventListener('click', connect)
    sendButton.addEventListener('click', send)

    connectErrorButton.addEventListener('click', connectError)
    sendErrorButton.addEventListener('click', sendError)

    // actions
    async function connectError () {
      await ethereum.request({
        method: 'wallet_enable',
        params: [{
          wallet_snap: { [snapId2.value]: {} },
        }]
      })
    }

    // here we get permissions to interact with and install the snap
    async function connect () {
      await ethereum.request({
        method: 'wallet_enable',
        params: [{
          wallet_snap: { [snapId.value]: {} },
        }]
      })
    }

    // here we call the error snap with any method
    async function sendError () {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId2.value, {
            method: 'test'
          }]
        })
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }

    // here we call the snap's "confirm" method
    async function send () {
      try {
        const response = await ethereum.request({
          method: 'wallet_invokeSnap',
          params: [snapId.value, {
            method: 'confirm',
            params: [promptInput.value, description.value, textAreaContent.value]
          }]
        })
        sendResults.innerHTML = response;
      } catch (err) {
        console.error(err)
        alert('Problem happened: ' + err.message || err)
      }
    }
  </script>
</html>